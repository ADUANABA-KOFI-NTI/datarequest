<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GES School Data Collection</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}
.gradient-bg {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.glass-effect {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
}
.input-focus {
    transition: all 0.3s ease;
}
.input-focus:focus {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}
.prefilled {
    background-color: #fef3c7 !important;
    border-color: #fbbf24 !important;
}
.loader {
    border: 3px solid #f3f4f6;
    border-top: 3px solid #6366f1;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
</head>
<body class="min-h-screen gradient-bg p-4">
<div class="max-w-5xl mx-auto py-8">
<!-- Header -->
<div class="text-center mb-8">
<div class="inline-block p-4 bg-white rounded-full shadow-lg mb-4">
<svg class="w-12 h-12 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
</svg>
</div>
<h1 class="text-4xl font-bold text-white mb-2">School Data Collection</h1>
<p class="text-indigo-100 text-lg">Ahafo Ano South West Education Directorate</p>
<p class="text-indigo-200 text-sm mt-1">Ghana Education Service</p>
<p id="autoSaveIndicator" class="text-gray-400 text-xs mt-2">Auto-saving...</p>
</div>

<!-- Main Form Card -->
<div class="glass-effect rounded-2xl shadow-2xl p-8 md:p-10">
<div id="statusMessage" class="hidden mb-6 p-4 rounded-xl flex items-start gap-3 animate-fade-in">
<svg id="statusIcon" class="w-6 h-6 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
</svg>
<span id="statusText" class="font-medium"></span>
</div>

<!-- Loading Indicator -->
<div id="loadingIndicator" class="hidden mb-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl flex items-center gap-3">
<div class="loader"></div>
<span class="text-blue-800 font-medium">Loading school data...</span>
</div>

<!-- Data Status Info -->
<div id="dataStatusInfo" class="hidden mb-6 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-xl">
<p class="text-yellow-800 font-medium">✨ Form pre-filled with existing data. You can update any field before submitting.</p>
</div>

<div class="space-y-8">
<!-- Circuit & School Selection -->
<section class="border-b-2 border-indigo-100 pb-8">
<div class="flex items-center gap-3 mb-6">
<div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
<span class="text-indigo-600 font-bold text-lg">1</span>
</div>
<h2 class="text-2xl font-bold text-gray-800">Circuit & School Selection</h2>
</div>
<div class="grid md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Name of Circuit *</label>
<select id="circuit" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select Circuit</option>
<option value="Achiase">Achiase</option>
<option value="Barniekrom">Barniekrom</option>
<option value="Bonkwaso">Bonkwaso</option>
<option value="Hwibaa">Hwibaa</option>
<option value="Kunsu">Kunsu</option>
<option value="Kunsu_Camp">Kunsu Camp</option>
<option value="Mankranso">Mankranso</option>
<option value="Mpasaso">Mpasaso</option>
<option value="Wioso">Wioso</option>
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Name of School *</label>
<select id="schoolName" required disabled class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed">
<option value="">Select Circuit First</option>
</select>
</div>
</div>
</section>

<!-- Basic Information -->
<section class="border-b-2 border-indigo-100 pb-8">
<div class="flex items-center gap-3 mb-6">
<div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
<span class="text-indigo-600 font-bold text-lg">2</span>
</div>
<h2 class="text-2xl font-bold text-gray-800">Basic Information</h2>
</div>
<div class="grid md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Community *</label>
<input type="text" id="community" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Unique ID *</label>
<input type="text" id="uniqueId" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Established Date (Year) *</label>
<input type="text" id="establishedDate" required placeholder="e.g., 2010" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Type *</label>
<select id="type" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="Public">Public</option>
<option value="Private">Private</option>
</select>
</div>
<div class="md:col-span-2">
<label class="block text-sm font-semibold text-gray-700 mb-2">Enrolling Organisation Unit *</label>
<input type="text" id="enrollingUnit" value="AHAFO ANO SOUTH WEST" readonly class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-600 cursor-not-allowed">
</div>
</div>
</section>

<!-- School Categories -->
<section class="border-b-2 border-indigo-100 pb-8">
<div class="flex items-center gap-3 mb-6">
<div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
<span class="text-indigo-600 font-bold text-lg">3</span>
</div>
<h2 class="text-2xl font-bold text-gray-800">School Categories</h2>
</div>
<div class="grid md:grid-cols-3 gap-4">
<label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-all">
<input type="checkbox" id="hasCreche" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<span class="text-sm font-medium text-gray-700">Creche</span>
</label>
<label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-all">
<input type="checkbox" id="hasKG" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<span class="text-sm font-medium text-gray-700">Kindergarten (KG)</span>
</label>
<label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-all">
<input type="checkbox" id="hasPrimary" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<span class="text-sm font-medium text-gray-700">Primary</span>
</label>
<label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-all">
<input type="checkbox" id="hasJHS" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<span class="text-sm font-medium text-gray-700">Junior High School (JHS)</span>
</label>
<label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-all">
<input type="checkbox" id="hasSecondary" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<span class="text-sm font-medium text-gray-700">Secondary</span>
</label>
<label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-all">
<input type="checkbox" id="hasTertiary" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<span class="text-sm font-medium text-gray-700">Tertiary</span>
</label>
<label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-300 transition-all">
<input type="checkbox" id="hasTVET" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
<span class="text-sm font-medium text-gray-700">TVET/Vocational</span>
</label>
</div>
</section>

<!-- Staff & Facilities -->
<section class="border-b-2 border-indigo-100 pb-8">
<div class="flex items-center gap-3 mb-6">
<div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
<span class="text-indigo-600 font-bold text-lg">4</span>
</div>
<h2 class="text-2xl font-bold text-gray-800">Staff & Facilities</h2>
</div>
<div class="grid md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Name of Headteacher</label>
<input type="text" id="headteacher" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Number of Classrooms</label>
<input type="number" id="numClassrooms" min="0" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Availability of Furniture</label>
<select id="hasFurniture" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Does the school have an ICT Lab?</label>
<select id="hasICTLab" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Availability of Library Facility</label>
<select id="hasLibrary" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Enrolled in School Feeding Programme (SFP)?</label>
<select id="inSFP" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Functional Wash Facility (Water)?</label>
<select id="hasWaterFacility" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Functional Wash Facility (Toilet)?</label>
<select id="hasToiletFacility" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
</div>
</section>

<!-- Support & Challenges -->
<section class="border-b-2 border-indigo-100 pb-8">
<div class="flex items-center gap-3 mb-6">
<div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
<span class="text-indigo-600 font-bold text-lg">5</span>
</div>
<h2 class="text-2xl font-bold text-gray-800">Support & Challenges</h2>
</div>
<div class="space-y-6">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Has the District supported this facility?</label>
<select id="districtSupport" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
<div id="supportNatureContainer" style="display: none;">
<label class="block text-sm font-semibold text-gray-700 mb-2">State the Nature of Support</label>
<textarea id="supportNature" rows="3" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Challenges facing this school</label>
<textarea id="challenges" rows="4" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
</div>
<div class="grid md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Has some of the challenges been addressed?</label>
<select id="challengesAddressed" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Is the School under Trees?</label>
<select id="underTrees" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
<option value="">Select...</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>
</div>
</div>
</section>

<!-- Enrollment Details -->
<section class="pb-8">
<div class="flex items-center gap-3 mb-6">
<div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
<span class="text-indigo-600 font-bold text-lg">6</span>
</div>
<h2 class="text-2xl font-bold text-gray-800">Enrollment Details</h2>
</div>
<div class="grid md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Number of Female Students</label>
<input type="number" id="femaleStudents" min="0" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Number of Male Students</label>
<input type="number" id="maleStudents" min="0" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Number of PWD Students</label>
<input type="number" id="pwdStudents" min="0" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Number of Teachers</label>
<input type="number" id="numTeachers" min="0" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Number of Students on GoG Scholarship</label>
<input type="number" id="gogScholarships" min="0" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl input-focus focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
</div>
</div>
</section>

<button id="submitBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
<span class="flex items-center justify-center gap-2">
<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
</svg>
Submit School Data
</span>
</button>
</div>
</div>

<!-- Footer -->
<div class="text-center mt-8 text-white">
<p class="text-sm opacity-90">© 2025 Ghana Education Service - Ahafo Ano South West</p>
</div>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwseyRZ4y7lkABXntI5FHNzW-GzhG5Rwb8WTMkytL3bhHv_geWpUYlAXtiNdqefosxh/exec';

const circuitSchoolMap = {
    "Achiase": [
    "ACHIASE D/A JHS", "ACHIASE D/A PRIAMRY", "ADIEMBRA D/A BASIC",
    "ANGO D/A BASIC", "ASUOKOR D/A JHS", "ASUOKOR D/A PRIMARY",
    "DOTIEM-MPASASO D/A JHS", "DOTIEM-MPASASO D/A PRIMARY", "MANHYIA D/A BASIC"
    ],
    "Barniekrom": [
    "BARNIEKROM D/A JHS", "BARNIEKROM D/A PRIMARY", "BARNIEKROM ISLAMIC BASIC",
    "DUNYAN NKWANTA D/A JHS", "DUNYAN NKWANTA D/A PRIMARY SCHOOL",
    "MMOROBEM D/A PRIMARY", "NYAMEBEKYERE III D/A BASIC",
    "NYINANUFU D/A JHS", "NYINANUFU D/A PRIMARY SCHOOL", "OHIAPAE D/A BASIC"
    ],
    "Bonkwaso": [
    "ABAASUA D/A BASIC", "AFRESENI D/A JHS", "AFRESENI D/A PRIMARY",
    "AFRESENI-CAMP D/A PRIMARY", "ASEKANTIA D/A PRIMARY", "BOATENGKROM D/A JHS",
    "BOATENGKROM ENG/ARABIC PRIMARY", "BONKWASO 1 D/A PRIMARY",
    "BONKWASO I D/A JHS", "BONKWASO I ISLAMIC BASIC", "BONKWASO II DA BASIC",
    "KRAMOKROM ENG/ARABIC D/A PRIMARY", "NKYENSEDANHO D/A BASIC"
    ],
    "Hwibaa": [
    "ABODEASE D/A BASIC", "ANITEMFE D/A BASIC", "ASUKESE ST. PETER'S D/A BASIC",
    "HWIBAA D/A JHS", "HWIBAA ISLAMIC BASIC", "HWIBAA R/C PRIMARY", "PEWODIE D/A BASIC"
    ],
    "Kunsu": [
    "KUNSU AL-AZIZ ISLAMIC BASIC", "KUNSU D/A JHS 'A'", "KUNSU D/A JHS 'B'",
    "KUNSU D/A PRIMARY 'A'", "KUNSU D/A PRIMARY 'B'", "KUNSU R/C BASIC SCHOOL",
    "KUNSU SDA PRIMARY", "NYAMEADOM D/A JHS", "NYAMEADOM D/A PRIMARY SCHOOL"
    ],
    "Kunsu_Camp": [
    "AGYEIBI D/A PRIMARY", "ASIBEY-NKWANTA D/A JHS", "ASIBEY-NKWANTA D/A PRIMARY",
    "BONKRON D/A BASIC", "GYAEKONTABUO ISLAMIC PRI.", "KOKOTEASUA D/A BASIC",
    "KUNSU-CAMP D/A JHS", "KUNSU-CAMP D/A PRIMARY", "KUNSU-DOTIEM D/A JHS",
    "KUNSU-DOTIEM D/A PRIMARY", "ODOYEFE D/A PRIMARY"
    ],
    "Mankranso": [
    "AHAFO ANO SOUTH-WEST DEO", "BEPOSO D/A JHS", "BEPOSO D/A PRIMARY SCHOOL", "MANKRANSO D/A JHS 'A'",
    "MANKRANSO D/A JHS 'B' SCHOOL", "MANKRANSO D/A PRIMARY 'A'",
    "MANKRANSO D/A PRIMARY 'B' SCHOOL", "MANKRANSO HOLY PROPHET ISLAMIC BASIC",
    "MANKRANSO METHODIST JHS", "MANKRANSO METHODIST PRIMARY"
    ],
    "Mpasaso": [
    "ADADEKROM D/A JHS", "ADADEKROM D/A PRIMARY", "BONSUKROM D/A JHS",
    "BONSUKROM D/A PRIMARY SCHOOL", "MPASASO I D/A PRIMARY", "MPASASO II D/A JHS",
    "MPASASO II D/A PRIMARY", "MPASASO II ST. PETERS R/C JHS",
    "MPASASO II ST. PETERS R/C PRIMARY", "MPASASO NURIYA ISLAMIC BASIC",
    "MPASASO TABIRI GYANSA D/A JHS", "NYAMEBEKYERE II D/A PRIMARY", "OSEIKROM D/A PRIMARY"
    ],
    "Wioso": [
    "DOMIABRA D/A JHS", "DOMIABRA R/C PRIMARY 'A'", "DOMIABRA R/C PRIMARY 'B'",
    "DOMIABRA-NYAMEBEKYERE IV D/A PRIMARY", "WIOSO ALMA MATTER D/A PRIMARY",
    "WIOSO D/A JHS", "WIOSO D/A PRIMARY", "WIOSO ST. PETER'S R/C JHS",
    "WIOSO ST. PETER'S R/C PRIMARY SCHOOL"
    ]
};

// Populate schools based on selected circuit
document.getElementById('circuit').addEventListener('change', function() {
    const circuit = this.value;
    const schoolSelect = document.getElementById('schoolName');

    schoolSelect.innerHTML = '<option value="">Select School</option>';

    if (circuit && circuitSchoolMap[circuit]) {
        schoolSelect.disabled = false;
        circuitSchoolMap[circuit].forEach(school => {
            const option = document.createElement('option');
            option.value = school;
            option.textContent = school;
            schoolSelect.appendChild(option);
        });
    } else {
        schoolSelect.disabled = true;
        schoolSelect.innerHTML = '<option value="">Select Circuit First</option>';
    }

    // Clear form when circuit changes
    clearFormHighlights();
});

// Fetch school data when a school is selected
document.getElementById('schoolName').addEventListener('change', async function() {
    const schoolName = this.value;

    if (!schoolName) {
        clearFormData(); // This will now reset checkboxes too
        clearFormHighlights();
        return;
    }

    // Show loading indicator
    document.getElementById('loadingIndicator').classList.remove('hidden');
    document.getElementById('dataStatusInfo').classList.add('hidden');
    document.getElementById('statusMessage').classList.add('hidden');

    try {
        const response = await fetch(`${SCRIPT_URL}?schoolName=${encodeURIComponent(schoolName)}`);
        const result = await response.json();

        document.getElementById('loadingIndicator').classList.add('hidden');

        if (result.status === 'success' && result.data) {
            // Pre-fill form with existing data
            populateForm(result.data);
            document.getElementById('dataStatusInfo').classList.remove('hidden');
        } else if (result.status === 'not_found') {
            showStatus('No existing data found for this school. Please fill in all fields.', false);
            clearFormData();
        } else {
            showStatus('Error loading school data. Please fill in manually.', false);
            clearFormData();
        }
    } catch (error) {
        document.getElementById('loadingIndicator').classList.add('hidden');
        showStatus('Error connecting to database. Please fill in manually.', false);
        clearFormData();
    }
});

function populateForm(data) {
    // Clear all highlights and reset checkboxes first
    clearFormHighlights();
    document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);

    // Log the data to see what fields are available
    console.log('Received data from database:', data);
    console.log('Available keys:', Object.keys(data));

    // Helper function to set value and highlight
    function setAndHighlight(elementId, value) {
        const element = document.getElementById(elementId);
        if (element && value !== undefined && value !== null && value !== '') {
            element.value = value;
            element.classList.add('prefilled');
            console.log(`Set ${elementId} to:`, value);
        } else {
            console.log(`Skipped ${elementId}, value:`, value);
        }
    }

    // Helper function to try multiple possible column names
    function getValue(data, possibleNames) {
        for (let name of possibleNames) {
        if (data[name] !== undefined && data[name] !== null && data[name] !== '') {
            return data[name];
        }
    }
        return null;
    }

    // Basic Information - try multiple possible column names
    setAndHighlight('community', getValue(data, ['Community', 'COMMUNITY', 'community']));
    setAndHighlight('uniqueId', getValue(data, ['Unique ID', 'UNIQUE ID', 'UniqueID', 'unique id', 'Unique_ID']));

    // Handle Established Date - try multiple formats
    const estDate = getValue(data, ['Established Date', 'ESTABLISHED DATE', 'EstablishedDate', 'established date', 'Year Established', 'YEAR ESTABLISHED', 'Established_Date']);
    if (estDate) {
        // Convert to string and extract year if it's a full date
        let yearString = estDate.toString();
        // If it contains a slash or dash, extract the year
        if (yearString.includes('/') || yearString.includes('-')) {
            yearString = yearString.split(/[\/\-]/)[0];
        }
        setAndHighlight('establishedDate', yearString);
    }

    // Parse School Categories - try multiple possible column names
    const schoolCategories = getValue(data, ['School Categories', 'SCHOOL CATEGORIES', 'SchoolCategories', 'school categories', 'School_Categories']) || '';
    if (schoolCategories) {
        const categories = schoolCategories.toLowerCase();

        // Handle "BASIC" category - check KG, Primary, and JHS
        if (categories.includes('basic') && !categories.includes('jhs') && !categories.includes('kg_&_primary')) {
            document.getElementById('hasKG').checked = true;
            document.getElementById('hasKG').parentElement.classList.add('prefilled');

            document.getElementById('hasPrimary').checked = true;
            document.getElementById('hasPrimary').parentElement.classList.add('prefilled');

            document.getElementById('hasJHS').checked = true;
            document.getElementById('hasJHS').parentElement.classList.add('prefilled');
        }
        // Handle "KG_&_PRIMARY" category
        else if (categories.includes('kg_&_primary') || categories.includes('kg & primary') || categories.includes('kg_and_primary')) {
            document.getElementById('hasKG').checked = true;
            document.getElementById('hasKG').parentElement.classList.add('prefilled');

            document.getElementById('hasPrimary').checked = true;
            document.getElementById('hasPrimary').parentElement.classList.add('prefilled');
        }
        // Handle individual categories
        else {
            if (categories.includes('creche')) {
                document.getElementById('hasCreche').checked = true;
                document.getElementById('hasCreche').parentElement.classList.add('prefilled');
            }
            if (categories.includes('kg') || categories.includes('kindergarten')) {
                document.getElementById('hasKG').checked = true;
                document.getElementById('hasKG').parentElement.classList.add('prefilled');
            }
            if (categories.includes('primary')) {
                document.getElementById('hasPrimary').checked = true;
                document.getElementById('hasPrimary').parentElement.classList.add('prefilled');
            }
            if (categories.includes('jhs') || categories.includes('junior high')) {
                document.getElementById('hasJHS').checked = true;
                document.getElementById('hasJHS').parentElement.classList.add('prefilled');
            }
            if (categories.includes('secondary') || categories.includes('shs')) {
                document.getElementById('hasSecondary').checked = true;
                document.getElementById('hasSecondary').parentElement.classList.add('prefilled');
            }
            if (categories.includes('tertiary')) {
                document.getElementById('hasTertiary').checked = true;
                document.getElementById('hasTertiary').parentElement.classList.add('prefilled');
            }
            if (categories.includes('tvet') || categories.includes('vocational')) {
                document.getElementById('hasTVET').checked = true;
                document.getElementById('hasTVET').parentElement.classList.add('prefilled');
            }
        }
    }

    // Enrollment Details - try multiple possible column names
    setAndHighlight('femaleStudents', getValue(data, ['Number of Female Students', 'Female Students', 'NUMBER OF FEMALE STUDENTS', 'Number_of_Female_Students']));
    setAndHighlight('maleStudents', getValue(data, ['Number of Male Students', 'Male Students', 'NUMBER OF MALE STUDENTS', 'Number_of_Male_Students']));
    setAndHighlight('numTeachers', getValue(data, ['Number of Teachers', 'Teachers', 'NUMBER OF TEACHERS', 'Number_of_Teachers']));

    // Staff Information
    setAndHighlight('headteacher', getValue(data, ['Name of Headteacher', 'NAME OF HEADTEACHER', 'Headteacher', 'headteacher', 'Name_of_Headteacher']));
}
function clearFormData() {
    // Clear all input fields except circuit and school
    document.querySelectorAll('input[type="text"]:not([readonly]), input[type="number"], textarea').forEach(el => {
        if (el.id !== 'enrollingUnit') {
            el.value = '';
        }
    });
    // RESET ALL CHECKBOXES
    document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);

    // Reset all select dropdowns to default (empty)
    document.querySelectorAll('select').forEach(el => {
        if (el.id !== 'circuit' && el.id !== 'schoolName' && el.id !== 'type') {
            el.value = '';
        }
    });

    clearFormHighlights();
}

function clearFormHighlights() {
    // Remove all prefilled highlights
    document.querySelectorAll('.prefilled').forEach(el => {
        el.classList.remove('prefilled');
    });
    document.getElementById('dataStatusInfo').classList.add('hidden');
}

// Show/hide support nature field
document.getElementById('districtSupport').addEventListener('change', function() {
    const container = document.getElementById('supportNatureContainer');
    container.style.display = this.value === 'Yes' ? 'block' : 'none';
});

function showStatus(message, isSuccess) {
    const statusDiv = document.getElementById('statusMessage');
    const statusIcon = document.getElementById('statusIcon');
    const statusText = document.getElementById('statusText');

    statusDiv.className = `mb-6 p-4 rounded-xl flex items-start gap-3 ${isSuccess ? 'bg-green-50 border-2 border-green-200' : 'bg-red-50 border-2 border-red-200'}`;
    statusIcon.className = `w-6 h-6 mt-0.5 flex-shrink-0 ${isSuccess ? 'text-green-600' : 'text-red-600'}`;
    statusText.className = `font-medium ${isSuccess ? 'text-green-800' : 'text-red-800'}`;
    statusText.textContent = message;

    statusDiv.classList.remove('hidden');
    statusDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

document.getElementById('submitBtn').addEventListener('click', submitForm);
// AUTO-SAVE FUNCTIONALITY
function autoSaveForm() {
    const formData = {
        circuit: document.getElementById('circuit').value,
        schoolName: document.getElementById('schoolName').value,
        community: document.getElementById('community').value,
        uniqueId: document.getElementById('uniqueId').value,
        establishedDate: document.getElementById('establishedDate').value,
        type: document.getElementById('type').value,
        hasCreche: document.getElementById('hasCreche').checked,
        hasKG: document.getElementById('hasKG').checked,
        hasPrimary: document.getElementById('hasPrimary').checked,
        hasJHS: document.getElementById('hasJHS').checked,
        hasSecondary: document.getElementById('hasSecondary').checked,
        hasTertiary: document.getElementById('hasTertiary').checked,
        hasTVET: document.getElementById('hasTVET').checked,
        headteacher: document.getElementById('headteacher').value,
        numClassrooms: document.getElementById('numClassrooms').value,
        hasFurniture: document.getElementById('hasFurniture').value,
        hasICTLab: document.getElementById('hasICTLab').value,
        hasLibrary: document.getElementById('hasLibrary').value,
        inSFP: document.getElementById('inSFP').value,
        hasWaterFacility: document.getElementById('hasWaterFacility').value,
        hasToiletFacility: document.getElementById('hasToiletFacility').value,
        districtSupport: document.getElementById('districtSupport').value,
        supportNature: document.getElementById('supportNature').value,
        challenges: document.getElementById('challenges').value,
        challengesAddressed: document.getElementById('challengesAddressed').value,
        underTrees: document.getElementById('underTrees').value,
        femaleStudents: document.getElementById('femaleStudents').value,
        maleStudents: document.getElementById('maleStudents').value,
        pwdStudents: document.getElementById('pwdStudents').value,
        numTeachers: document.getElementById('numTeachers').value,
        gogScholarships: document.getElementById('gogScholarships').value,
        timestamp: new Date().toISOString()
    };

    try {
        const formDataJSON = JSON.stringify(formData);
        document.cookie = `schoolFormData=${encodeURIComponent(formDataJSON)}; max-age=604800; path=/`;

        // Show save indicator
        const saveIndicator = document.getElementById('autoSaveIndicator');
        if (saveIndicator) {
            saveIndicator.textContent = '✓ Progress saved';
            saveIndicator.classList.remove('text-gray-400');
            saveIndicator.classList.add('text-green-600');
            setTimeout(() => {
                saveIndicator.classList.remove('text-green-600');
                saveIndicator.classList.add('text-gray-400');
                saveIndicator.textContent = 'Auto-saving...';
            }, 2000);
        }
    } catch (error) {
        console.error('Error saving form data:', error);
    }
}

function loadSavedForm() {
    try {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === 'schoolFormData') {
                const formData = JSON.parse(decodeURIComponent(value));

                // Restore all form fields
                if (formData.circuit) document.getElementById('circuit').value = formData.circuit;
                if (formData.schoolName) {
                    // Trigger circuit change to populate schools
                    document.getElementById('circuit').dispatchEvent(new Event('change'));
                    setTimeout(() => {
                        document.getElementById('schoolName').value = formData.schoolName;
                    }, 100);
                }
                if (formData.community) document.getElementById('community').value = formData.community;
                if (formData.uniqueId) document.getElementById('uniqueId').value = formData.uniqueId;
                if (formData.establishedDate) document.getElementById('establishedDate').value = formData.establishedDate;
                if (formData.type) document.getElementById('type').value = formData.type;

                // Restore checkboxes
                document.getElementById('hasCreche').checked = formData.hasCreche || false;
                document.getElementById('hasKG').checked = formData.hasKG || false;
                document.getElementById('hasPrimary').checked = formData.hasPrimary || false;
                document.getElementById('hasJHS').checked = formData.hasJHS || false;
                document.getElementById('hasSecondary').checked = formData.hasSecondary || false;
                document.getElementById('hasTertiary').checked = formData.hasTertiary || false;
                document.getElementById('hasTVET').checked = formData.hasTVET || false;

                // Restore other fields
                if (formData.headteacher) document.getElementById('headteacher').value = formData.headteacher;
                if (formData.numClassrooms) document.getElementById('numClassrooms').value = formData.numClassrooms;
                if (formData.hasFurniture) document.getElementById('hasFurniture').value = formData.hasFurniture;
                if (formData.hasICTLab) document.getElementById('hasICTLab').value = formData.hasICTLab;
                if (formData.hasLibrary) document.getElementById('hasLibrary').value = formData.hasLibrary;
                if (formData.inSFP) document.getElementById('inSFP').value = formData.inSFP;
                if (formData.hasWaterFacility) document.getElementById('hasWaterFacility').value = formData.hasWaterFacility;
                if (formData.hasToiletFacility) document.getElementById('hasToiletFacility').value = formData.hasToiletFacility;
                if (formData.districtSupport) document.getElementById('districtSupport').value = formData.districtSupport;
                if (formData.supportNature) document.getElementById('supportNature').value = formData.supportNature;
                if (formData.challenges) document.getElementById('challenges').value = formData.challenges;
                if (formData.challengesAddressed) document.getElementById('challengesAddressed').value = formData.challengesAddressed;
                if (formData.underTrees) document.getElementById('underTrees').value = formData.underTrees;
                if (formData.femaleStudents) document.getElementById('femaleStudents').value = formData.femaleStudents;
                if (formData.maleStudents) document.getElementById('maleStudents').value = formData.maleStudents;
                if (formData.pwdStudents) document.getElementById('pwdStudents').value = formData.pwdStudents;
                if (formData.numTeachers) document.getElementById('numTeachers').value = formData.numTeachers;
                if (formData.gogScholarships) document.getElementById('gogScholarships').value = formData.gogScholarships;

                // Show restore notification
                showStatus('Your previous progress has been restored!', true);
                setTimeout(() => {
                    document.getElementById('statusMessage').classList.add('hidden');
                }, 4000);

                return true;
            }
        }
    } catch (error) {
        console.error('Error loading saved form data:', error);
    }
    return false;
}

function clearSavedForm() {
    document.cookie = 'schoolFormData=; max-age=0; path=/';
}

// Auto-save whenever user types or changes something
document.addEventListener('DOMContentLoaded', function() {
    // Load saved data when page loads
    loadSavedForm();

    // Add auto-save listeners to all form fields
    const formElements = document.querySelectorAll('input, select, textarea');
    formElements.forEach(element => {
        element.addEventListener('change', autoSaveForm);
        element.addEventListener('input', debounce(autoSaveForm, 1000));
    });
});

// Debounce function to prevent too many saves
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
        clearTimeout(timeout);
        func(...args);
    };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
async function submitForm() {
    const btn = document.getElementById('submitBtn');

    // Validate required fields
    const circuit = document.getElementById('circuit').value;
    const schoolName = document.getElementById('schoolName').value;
    const community = document.getElementById('community').value;
    const uniqueId = document.getElementById('uniqueId').value;
    const establishedDate = document.getElementById('establishedDate').value;

    if (!circuit || !schoolName || !community || !uniqueId || !establishedDate) {
        showStatus('Please fill in all required fields marked with *', false);
        return;
    }

    btn.disabled = true;
    btn.innerHTML = '<span class="flex items-center justify-center gap-2"><svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Submitting...</span>';

    const formData = {
        circuit: circuit,
        schoolName: schoolName,
        community: community,
        uniqueId: uniqueId,
        establishedDate: establishedDate,
        type: document.getElementById('type').value,
        enrollingUnit: document.getElementById('enrollingUnit').value,
        hasCreche: document.getElementById('hasCreche').checked ? 'Yes' : 'No',
        hasKG: document.getElementById('hasKG').checked ? 'Yes' : 'No',
        hasPrimary: document.getElementById('hasPrimary').checked ? 'Yes' : 'No',
        hasJHS: document.getElementById('hasJHS').checked ? 'Yes' : 'No',
        hasSecondary: document.getElementById('hasSecondary').checked ? 'Yes' : 'No',
        hasTertiary: document.getElementById('hasTertiary').checked ? 'Yes' : 'No',
        hasTVET: document.getElementById('hasTVET').checked ? 'Yes' : 'No',
        headteacher: document.getElementById('headteacher').value,
        numClassrooms: document.getElementById('numClassrooms').value,
        hasFurniture: document.getElementById('hasFurniture').value,
        hasICTLab: document.getElementById('hasICTLab').value,
        hasLibrary: document.getElementById('hasLibrary').value,
        inSFP: document.getElementById('inSFP').value,
        hasWaterFacility: document.getElementById('hasWaterFacility').value,
        hasToiletFacility: document.getElementById('hasToiletFacility').value,
        districtSupport: document.getElementById('districtSupport').value,
        supportNature: document.getElementById('supportNature').value,
        challenges: document.getElementById('challenges').value,
        challengesAddressed: document.getElementById('challengesAddressed').value,
        underTrees: document.getElementById('underTrees').value,
        femaleStudents: document.getElementById('femaleStudents').value,
        maleStudents: document.getElementById('maleStudents').value,
        pwdStudents: document.getElementById('pwdStudents').value,
        numTeachers: document.getElementById('numTeachers').value,
        gogScholarships: document.getElementById('gogScholarships').value
    };

    try {
        const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
            'Content-Type': 'application/json',
        },
            body: JSON.stringify(formData)
        });

        showStatus('School data submitted successfully!', true);
        clearSavedForm(); // Clear the saved progress
        // Reset form after 2 seconds
        setTimeout(() => {
            document.querySelectorAll('input[type="text"]:not([readonly]), input[type="number"], textarea').forEach(el => {
                if (el.id !== 'enrollingUnit') {
                    el.value = '';
                }
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
            document.querySelectorAll('select').forEach(el => {
                if (el.id !== 'type') {
                    el.value = el.id === 'circuit' || el.id === 'schoolName' ? '' : (el.id === 'type' ? 'Public' : '');
                }
            });
            document.getElementById('circuit').value = '';
            document.getElementById('schoolName').disabled = true;
            document.getElementById('schoolName').innerHTML = '<option value="">Select Circuit First</option>';
            document.getElementById('supportNatureContainer').style.display = 'none';
            clearFormHighlights();
        }, 2000);

    } catch (error) {
        showStatus('Error submitting form. Please try again.', false);
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span class="flex items-center justify-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Submit School Data</span>';
    }
}
</script>
</body>
</html>